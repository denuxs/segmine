<div class="flex justify-between mb-4">
  <div class="text-2xl font-bold text-slate-700">Formulario</div>

  <button mat-stroked-button color="primary" routerLink="/admin/surveys">
    <mat-icon [svgIcon]="'heroicons_solid:arrow-left'"></mat-icon>
    <span>Regresar</span>
  </button>
</div>

<form [formGroup]="surveyForm" (ngSubmit)="saveEvaluation()">
  <div class="flex flex-col p-8 space-y-4 bg-white border rounded-lg">

    <div class="flex flex-col">
      <mat-label class="mb-1 font-medium text-slate-500">Titulo</mat-label>
      <mat-form-field subscriptSizing="dynamic">
        <input matInput id="title" name="title" formControlName="title" />
        <mat-error *ngFor="let err of errors['title']">
          {{ err }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="flex flex-col">
      <mat-label class="mb-1 font-medium text-slate-500">Descripci√≥n</mat-label>
      <mat-form-field subscriptSizing="dynamic">
        <textarea matInput formControlName="description" id="description" name="description" [rows]="1"></textarea>
        <mat-error *ngFor="let err of errors['description']">
          {{ err }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="flex flex-col">
      <mat-label class="mb-1 font-medium text-slate-500">Curso</mat-label>
      <mat-form-field subscriptSizing="dynamic">
        <mat-select formControlName="course" id="course" name="course">
          <mat-option *ngFor="let course of courses" [value]="course.id">{{
            course.title
            }}</mat-option>
        </mat-select>
        <mat-error *ngFor="let err of errors['course']">
          {{ err }}
        </mat-error>
      </mat-form-field>
    </div>
  </div>

  <div class="mt-8 text-2xl font-bold text-slate-700">Preguntas</div>

  <ng-container *ngFor="
      let question of surveyForm.get('questions')['controls'];
      let questionIndex = index
    ">
    <div class="p-4 mt-4 bg-white border rounded-lg">
      <div class="flex space-x-2">
        <mat-form-field class="flex-auto" subscriptSizing="dynamic">
          <mat-label>Pregunta</mat-label>
          <input matInput [formControl]="question.get('question')" />
        </mat-form-field>

        <mat-form-field class="w-40" subscriptSizing="dynamic">
          <mat-label>Campo</mat-label>
          <mat-select [formControl]="question.get('question_type')">
            <mat-option value="simple">Simple</mat-option>
            <mat-option value="multiple">Multiple</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="w-20">
          <button mat-icon-button color="warn" (click)="removeQuestionField(questionIndex)" matTooltip="Eliminar">
            <mat-icon [svgIcon]="'heroicons_solid:trash'"></mat-icon>
          </button>
        </div>
      </div>

      <!-- <div class="flex flex-col mt-2">
        <label for="">Requerido:</label>
        <mat-radio-group color="primary" id="is_active" name="is_active">
          <mat-radio-button [value]="true">Si</mat-radio-button>
          <mat-radio-button [value]="false">No</mat-radio-button>
        </mat-radio-group>
      </div> -->

      <div class="pt-4 text-xl font-medium">Respuestas</div>

      <ng-container *ngFor="
          let answer of answers(questionIndex).controls;
          let answerIndex = index
        ">
        <div class="flex mt-2 space-x-2">
          <mat-form-field class="flex-auto" [subscriptSizing]="'dynamic'">
            <input matInput [formControl]="answer.get('answer')" />
          </mat-form-field>

          <div class="w-20">
            <a mat-icon-button color="warn" (click)="removeAnswerField(questionIndex, answerIndex)"
              matTooltip="Eliminar">
              <mat-icon [svgIcon]="'heroicons_solid:trash'"></mat-icon>
            </a>
          </div>
        </div>
      </ng-container>
      <a mat-stroked-button color="accent" class="mt-2" (click)="addAnswerField(questionIndex)">
        <mat-icon [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
        <span class="text-secondary group-hover:underline">Agregar Respuesta</span>
      </a>
    </div>
  </ng-container>

  <a mat-flat-button class="mt-4" color="accent" (click)="addQuestionField()">
    <mat-icon [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
    <span>Agregar Pregunta</span>
  </a>

  <div class="flex justify-end">
    <button mat-flat-button color="primary" type="submit" [disabled]="!surveyForm.valid">
      <mat-icon [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
      <span>Guardar</span>
    </button>
  </div>
</form>
